{"version":3,"sources":["uni-app:///main.js",null,"webpack:///H:/phpStudy/WWW/tx_im/pages/tim/room.vue?2b27","webpack:///H:/phpStudy/WWW/tx_im/pages/tim/room.vue?048f","webpack:///H:/phpStudy/WWW/tx_im/pages/tim/room.vue?95d6","uni-app:///pages/tim/room.vue","webpack:///H:/phpStudy/WWW/tx_im/pages/tim/room.vue?a9d7","webpack:///H:/phpStudy/WWW/tx_im/pages/tim/room.vue?a176"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,wF;AACAA,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACc;;;AAGjE;AACyK;AACzK,gBAAgB,gLAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAA+nB,CAAgB,6nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACgJnpB;AACA,gD;;AAEA;AACA,MADA,kBACA;AACA;AACA;AACA,8BAFA;AAGA,kBAHA;AAIA,sBAJA;AAKA,oBALA;AAMA,0BANA;AAOA,eAPA;AAQA,qBARA;AASA,iBATA;AAUA,eAVA;;;AAaA;AACA,iBAdA;AAeA;AACA,6BAhBA;AAiBA,4BAjBA;AAkBA,kBAlBA;AAmBA,sBAnBA;;AAqBA,oBArBA;AAsBA,cAtBA;;AAwBA;;AAEA;AACA,wCA3BA;;AA6BA,oBA7BA;AA8BA,uBA9BA;AA+BA,4BA/BA;AAgCA,sBAhCA;AAiCA,qBAjCA;AAkCA,wCAlCA;AAmCA,uBAnCA;AAoCA,qBApCA;;AAsCA;AACA,0CAvCA;AAwCA,qBAxCA;AAyCA,sBAzCA;AA0CA;AACA,yBA3CA;AA4CA;AACA,oBA7CA;AA8CA;AACA,qBA/CA;AAgDA,uCAhDA;AAiDA;AACA,68FAlDA;AAmDA;AACA,sBApDA;AAqDA;AACA,iBADA,EACA;AACA,kBAFA;AAGA,kBAHA;AAIA,sBAJA;AAKA,mBALA,EArDA;;;AA6DA,GA/DA;AAgEA;AACA;AACA,6FADA,GADA,CAhEA;;;AAqEA;AACA,sBADA,8BACA,MADA,EACA,MADA,EACA;AACA;AACA;AACA,KAJA,EArEA;;AA2EA,QA3EA,kBA2EA,MA3EA,EA2EA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAJA;AAKA;AACA;AACA;AACA;AACA,KAFA;;AAIA;AACA;AACA;AACA,KAFA;AAGA;AACA;AACA;AACA,KAFA;;AAIA,GAvGA;AAwGA,QAxGA,oBAwGA;AACA;AACA;AACA,GA3GA;AA4GA,UA5GA,sBA4GA;AACA;AACA;AACA;AACA;AACA;AACA,KAHA,EAGA,KAHA,CAGA;AACA;AACA;AACA,KANA;AAOA,GAtHA;AAuHA;AACA;AACA,eAFA,uBAEA,GAFA,EAEA;AACA;AACA;AACA,KALA;AAMA;AACA,cAPA,sBAOA,KAPA,EAOA;AACA;AACA;AACA;AACA,KAXA;AAYA;AACA,aAbA,qBAaA,MAbA,EAaA,MAbA,EAaA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SANA,MAMA;AACA;AACA;AACA;AACA,OAXA,MAWA;AACA;AACA;AACA;AACA;AACA,KA9BA;AA+BA;AACA,eAhCA,uBAgCA,CAhCA,EAgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAFA,CAEA;AACA;AACA;AACA,OALA;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,KApDA;AAqDA;AACA,cAtDA,wBAsDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DANA,CAMA;AACA;AACA;AACA,OATA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA,OANA;AAOA,KA5EA;AA6EA;AACA,cA9EA,sBA8EA,OA9EA,EA8EA;AACA;AACA,iCAFA,CAEA;AACA,iCAHA,CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAxFA;AAyFA;AACA,YA1FA,sBA0FA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA,KAnGA;AAoGA;AACA,cArGA,wBAqGA;AACA;AACA,KAvGA;AAwGA;AACA,cAzGA,wBAyGA;AACA;AACA;AACA;AACA;AACA,OAHA,EAGA,GAHA;AAIA,KA/GA;AAgHA;AACA,eAjHA,yBAiHA;AACA;AACA,KAnHA;AAoHA;AACA,UArHA,oBAqHA;AACA;AACA,KAvHA;AAwHA;AACA,oBAzHA,8BAyHA;AACA;AACA,8BADA;;AAGA;AACA,KA9HA;AA+HA;AACA,YAhIA,oBAgIA,IAhIA,EAgIA;AACA;AACA;AACA,0BADA;AAEA,4CAFA,EAEA;AACA;AACA,WADA;AAEA;AACA,uCADA;AAEA;AACA;AACA;AACA;AACA;AACA,eAPA,IAFA,EACA;;AAUA;AACA,SAfA;;AAiBA,KAnJA;AAoJA;AACA,eArJA,yBAqJA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA,KA7JA;AA8JA;AACA,YA/JA,oBA+JA,EA/JA,EA+JA;AACA;AACA,KAjKA;;AAmKA;AACA,iBApKA,2BAoKA;AACA;AACA;AACA;AACA,KAxKA;AAyKA;AACA,YA1KA,sBA0KA;AACA,wBADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBARA,CAQA;AACA,KAnLA;AAoLA;AACA,gBArLA,wBAqLA,GArLA,EAqLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAhBA;AAiBA;AACA,KAxMA;;AA0MA;AACA,WA3MA,mBA2MA,OA3MA,EA2MA,IA3MA,EA2MA;AACA;AACA,yBADA;AAEA,+BAFA;AAGA;AACA,4BADA,EAHA;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA,SAHA;AAIA,OALA;AAMA,KA3NA;;AA6NA;AACA,cA9NA,sBA8NA,GA9NA,EA8NA;AACA;AACA,KAhOA;AAiOA;AACA,eAlOA,uBAkOA,GAlOA,EAkOA;AACA;AACA,KApOA;AAqOA;AACA,aAtOA,qBAsOA,GAtOA,EAsOA;AACA;AACA;AACA;AACA,KA1OA;AA2OA,qBA3OA,6BA2OA,GA3OA,EA2OA;AACA;AACA,KA7OA;AA8OA;AACA,oBA/OA,4BA+OA,GA/OA,EA+OA;AACA;AACA,KAjPA;AAkPA;AACA,2BAnPA,mCAmPA,GAnPA,EAmPA;AACA;AACA,KArPA;AAsPA;AACA,mBAvPA,2BAuPA,GAvPA,EAuPA,KAvPA,EAuPA;AACA;AACA;AACA,uBADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,kBADA,EACA;AACA,uBAFA;AAGA,gDAHA;AAIA,iCAJA;AAKA,wBALA;;AAOA,SARA,MAQA;AACA;AACA,kBADA,EACA;AACA,2BAFA;AAGA,kDAHA;AAIA,4BAJA;AAKA,yBALA;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OA5BA,EA4BA,GA5BA;AA6BA,KA3RA;;AA6RA;AACA,oBA9RA,8BA8RA;AACA;AACA;AACA;AACA,OAFA,EAEA,GAFA;AAGA,KAnSA;AAoSA,iBApSA,yBAoSA,OApSA,EAoSA,IApSA,EAoSA;AACA;AACA;AACA;AACA;AACA,KAzSA;AA0SA;AACA,aA3SA,qBA2SA,GA3SA,EA2SA;AACA;AACA,+CADA;;AAGA,KA/SA;AAgTA;AACA,WAjTA,mBAiTA,GAjTA,EAiTA;AACA;AACA,yBADA;AAEA,gCAFA;AAGA,6BAHA;;AAKA,KAvTA;AAwTA;AACA,aAzTA,qBAyTA,GAzTA,EAyTA;AACA;AACA;AACA;AACA;AACA,OAFA;AAGA,KA/TA;AAgUA;AACA,cAjUA,sBAiUA,CAjUA,EAiUA;AACA;AACA;AACA;AACA;AACA;AACA,6CANA,CAMA;AACA,KAxUA;AAyUA;AACA,eA1UA,uBA0UA,CA1UA,EA0UA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KAjVA;AAkVA;AACA,eAnVA,yBAmVA;AACA;AACA;AACA;AACA,2BAJA,CAIA;AACA,2BALA,CAKA;AACA,KAzVA;AA0VA;AACA,YA3VA,oBA2VA,CA3VA,EA2VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA,KAxWA;AAyWA;AACA,YA1WA,oBA0WA,CA1WA,EA0WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAPA,CAOA;AACA,KAlXA;AAmXA;AACA,aApXA,qBAoXA,CApXA,EAoXA;AACA;AACA;AACA;AACA;AACA,mBADA;AAEA,6BAFA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA,OAZA,MAYA;AACA;AACA;AACA;AACA,KAtYA;AAuYA;AACA,eAxYA,yBAwYA;AACA;AACA;AACA,KA3YA;AA4YA,WA5YA,qBA4YA;AACA;AACA,KA9YA,EAvHA,E;;;;;;;;;;;;;ACnJA;AAAA;AAAA;AAAA;AAA4pC,CAAgB,mlCAAG,EAAC,C;;;;;;;;;;;ACAhrC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/tim/room.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/tim/room.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./room.vue?vue&type=template&id=7b75dac5&\"\nvar renderjs\nimport script from \"./room.vue?vue&type=script&lang=js&\"\nexport * from \"./room.vue?vue&type=script&lang=js&\"\nimport style0 from \"./room.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"phpStudy/WWW/tx_im/pages/tim/room.vue\"\nexport default component.exports","export * from \"-!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=template&id=7b75dac5&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.msgList, function(item, index) {\n    var m0 = _vm.nodesFliter(item.payload.text)\n    var m1 = _vm.timeFliter(item.time)\n    var m2 = _vm.nodesFliter(item.payload.text)\n    return {\n      $orig: _vm.__get_orig(item),\n      m0: m0,\n      m1: m1,\n      m2: m2\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<view class=\"content\" @touchstart=\"hideDrawer\">\n\t\t\t<scroll-view class=\"msg-list\" scroll-y=\"true\" :scroll-with-animation=\"scrollAnimation\" :scroll-top=\"scrollTop\"\n\t\t\t :scroll-into-view=\"scrollToView\" @scrolltoupper=\"loadHistory\" upper-threshold=\"50\">\n\t\t\t\t<!-- 加载历史数据waitingUI -->\n\t\t\t\t<view class=\"loading\" v-if=\"isHistoryLoading\">\n\t\t\t\t\t<view class=\"spinner\">\n\t\t\t\t\t\t<view class=\"rect1\"></view>\n\t\t\t\t\t\t<view class=\"rect2\"></view>\n\t\t\t\t\t\t<view class=\"rect3\"></view>\n\t\t\t\t\t\t<view class=\"rect4\"></view>\n\t\t\t\t\t\t<view class=\"rect5\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"row\" v-for=\"(item,index) in msgList\" :key=\"index\" :id=\"item.ID\">\n\t\t\t\t\t<!-- 用户消息 -->\n\t\t\t\t\t<block>\n\t\t\t\t\t\t<!-- 自己发出的消息 -->\n\t\t\t\t\t\t<view class=\"my\" v-if=\"item.flow=='out'\">\n\t\t\t\t\t\t\t<!-- 左-消息 -->\n\t\t\t\t\t\t\t<view class=\"left\">\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\n\t\t\t\t\t\t\t\t<view v-if=\"item.type==TIM.TYPES.MSG_TEXT\" class=\"bubble\">\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"nodesFliter(item.payload.text)\"></rich-text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<!-- 右-头像 -->\n\t\t\t\t\t\t\t<view class=\"right\">\n\t\t\t\t\t\t\t\t<image :src=\"userInfo.img\"></image>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<!-- 别人发出的消息 -->\n\t\t\t\t\t\t<view class=\"other\" v-else>\n\t\t\t\t\t\t\t<!-- 左-头像 -->\n\t\t\t\t\t\t\t<view class=\"left\">\n\t\t\t\t\t\t\t\t<image :src=\"toUserInfo.img\"></image>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<!-- 右-用户名称-时间-消息 -->\n\t\t\t\t\t\t\t<view class=\"right\">\n\t\t\t\t\t\t\t\t<view class=\"username\">\n\t\t\t\t\t\t\t\t\t<view class=\"name\">{{toUserInfo.user}}</view>\n\t\t\t\t\t\t\t\t\t<view class=\"time\">{{timeFliter(item.time)}}</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\n\t\t\t\t\t\t\t\t<view v-if=\"item.type==TIM.TYPES.MSG_TEXT\" class=\"bubble\">\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"nodesFliter(item.payload.text)\"></rich-text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</block>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t\t<!-- 抽屉栏 -->\n\t\t<view class=\"popup-layer\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\n\t\t\t<!-- 表情 -->\n\t\t\t<swiper class=\"emoji-swiper\" :class=\"{hidden:hideEmoji}\" indicator-dots=\"true\" duration=\"150\">\n\t\t\t\t<swiper-item v-for=\"(page,pid) in emojiList\" :key=\"pid\">\n\t\t\t\t\t<view v-for=\"(em,eid) in page\" :key=\"eid\" @tap=\"addEmoji(em)\">\n\t\t\t\t\t\t<image mode=\"widthFix\" :src=\"'/static/img/emoji/'+em.url\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</swiper-item>\n\t\t\t</swiper>\n\t\t\t<!-- 更多功能 相册-拍照-红包 -->\n\t\t\t<view class=\"more-layer\" :class=\"{hidden:hideMore}\">\n\t\t\t\t<view class=\"list\">\n\t\t\t\t\t<view class=\"box\" @tap=\"chooseImage\">\n\t\t\t\t\t\t<view class=\"icon tupian2\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"box\" @tap=\"camera\">\n\t\t\t\t\t\t<view class=\"icon paizhao\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"box\" @tap=\"handRedEnvelopes\">\n\t\t\t\t\t\t<view class=\"icon hongbao\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<!-- 底部输入栏 -->\n\t\t<view class=\"input-box\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\n\t\t\t<!-- H5下不能录音，输入栏布局改动一下 -->\n\t\t\t<!-- #ifndef H5 -->\n\t\t\t<view class=\"voice\">\n\t\t\t\t<view class=\"icon\" :class=\"isVoice?'jianpan':'yuyin'\" @tap=\"switchVoice\"></view>\n\t\t\t</view>\n\t\t\t<!-- #endif -->\n\t\t\t<!-- #ifdef H5 -->\n\t\t\t<view class=\"more\" @tap=\"showMore\">\n\t\t\t\t<view class=\"icon add\"></view>\n\t\t\t</view>\n\t\t\t<!-- #endif -->\n\t\t\t<view class=\"textbox\">\n\t\t\t\t<view class=\"voice-mode\" :class=\"[isVoice?'':'hidden',recording?'recording':'']\" @touchstart=\"voiceBegin\"\n\t\t\t\t @touchmove.stop.prevent=\"voiceIng\" @touchend=\"voiceEnd\" @touchcancel=\"voiceCancel\">{{voiceTis}}</view>\n\t\t\t\t<view class=\"text-mode\" :class=\"isVoice?'hidden':''\">\n\t\t\t\t\t<view class=\"box\">\n\t\t\t\t\t\t<textarea auto-height=\"true\" v-model=\"textMsg\" @focus=\"textareaFocus\" />\n\t\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"em\" @tap=\"chooseEmoji\">\n\t\t\t\t\t\t<view class=\"icon biaoqing\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<!-- #ifndef H5 -->\n\t\t\t<view class=\"more\" @tap=\"showMore\">\n\t\t\t\t<view class=\"icon add\"></view>\n\t\t\t</view>\n\t\t\t<!-- #endif -->\n\t\t\t<view class=\"send\" :class=\"isVoice?'hidden':''\" @tap=\"sendText\">\n\t\t\t\t<view class=\"btn\">发送</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<!-- 录音UI效果 -->\n\t\t<view class=\"record\" :class=\"recording?'':'hidden'\">\n\t\t\t<view class=\"ing\" :class=\"willStop?'hidden':''\"><view class=\"icon luyin2\" ></view></view>\n\t\t\t<view class=\"cancel\" :class=\"willStop?'':'hidden'\"><view class=\"icon chehui\" ></view></view>\n\t\t\t<view class=\"tis\" :class=\"willStop?'change':''\">{{recordTis}}</view>\n\t\t</view>\n\t\t<!-- 红包弹窗 -->\n\t\t<view class=\"windows\" :class=\"windowsState\">\n\t\t\t<!-- 遮罩层 -->\n\t\t\t<view class=\"mask\" @touchmove.stop.prevent=\"discard\" @tap=\"closeRedEnvelope\"></view>\n\t\t\t<view class=\"layer\" @touchmove.stop.prevent=\"discard\">\n\t\t\t\t<view class=\"open-redenvelope\">\n\t\t\t\t\t<view class=\"top\">\n\t\t\t\t\t\t<view class=\"close-btn\">\n\t\t\t\t\t\t\t<view class=\"icon close\" @tap=\"closeRedEnvelope\"></view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<image src=\"/static/img/im/face/face_1.jpg\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"from\">来自{{redenvelopeData.from}}</view>\n\t\t\t\t\t<view class=\"blessing\">{{redenvelopeData.blessing}}</view>\n\t\t\t\t\t<view class=\"money\">{{redenvelopeData.money}}</view>\n\t\t\t\t\t<view class=\"showDetails\" @tap=\"toDetails(redenvelopeData.rid)\">\n\t\t\t\t\t\t查看领取详情 <view class=\"icon to\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t</view>\n\t</view>\n</template>\n<script>\n\timport userList from '../../commen/tim/user.js'\n\timport {mapState} from \"vuex\";\n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\t//TIM变量\n\t\t\t\tconversationActive:null,\n\t\t\t\ttoUserId:'',\n\t\t\t\ttoUserInfo:null,\n\t\t\t\tuserInfo:null,\n\t\t\t\tnextReqMessageID:'',\n\t\t\t\tcount:15,\n\t\t\t\tisCompleted:'',\n\t\t\t\tmsgList:[],\n\t\t\t    TIM:null, \n\t\t\t\t\n\t\t\t\t\n\t\t\t\t//文字消息\n\t\t\t\ttextMsg:'',\n\t\t\t\t//消息列表\n\t\t\t\tisHistoryLoading:false,\n\t\t\t\tscrollAnimation:false,\n\t\t\t\tscrollTop:0,\n\t\t\t\tscrollToView:'',\n\t\t\t\n\t\t\t\tmsgImgList:[],\n\t\t\t\tmyuid:0,\n\t\t\t\t\n\t\t\t\t//录音相关参数\n\t\t\t\t// #ifndef H5\n\t\t\t\t//H5不能录音\n\t\t\t\tRECORDER:uni.getRecorderManager(),\n\t\t\t\t// #endif\n\t\t\t\tisVoice:false,\n\t\t\t\tvoiceTis:'按住 说话',\n\t\t\t\trecordTis:\"手指上滑 取消发送\",\n\t\t\t\trecording:false,\n\t\t\t\twillStop:false,\n\t\t\t\tinitPoint:{identifier:0,Y:0},\n\t\t\t\trecordTimer:null,\n\t\t\t\trecordLength:0,\n\t\t\t\t\n\t\t\t\t//播放语音相关参数\n\t\t\t\tAUDIO:uni.createInnerAudioContext(),\n\t\t\t\tplayMsgid:null,\n\t\t\t\tVoiceTimer:null,\n\t\t\t\t// 抽屉参数\n\t\t\t\tpopupLayerClass:'',\n\t\t\t\t// more参数\n\t\t\t\thideMore:true,\n\t\t\t\t//表情定义\n\t\t\t\thideEmoji:true,\n\t\t\t\temojiList:this.$commen.emojiList,\n\t\t\t\t//表情图片图床名称 ，由于我上传的第三方图床名称会有改变，所以有此数据来做对应，您实际应用中应该不需要\n\t\t\t\tonlineEmoji:{\"100.gif\":\"AbNQgA.gif\",\"101.gif\":\"AbN3ut.gif\",\"102.gif\":\"AbNM3d.gif\",\"103.gif\":\"AbN8DP.gif\",\"104.gif\":\"AbNljI.gif\",\"105.gif\":\"AbNtUS.gif\",\"106.gif\":\"AbNGHf.gif\",\"107.gif\":\"AbNYE8.gif\",\"108.gif\":\"AbNaCQ.gif\",\"109.gif\":\"AbNN4g.gif\",\"110.gif\":\"AbN0vn.gif\",\"111.gif\":\"AbNd3j.gif\",\"112.gif\":\"AbNsbV.gif\",\"113.gif\":\"AbNwgs.gif\",\"114.gif\":\"AbNrD0.gif\",\"115.gif\":\"AbNDuq.gif\",\"116.gif\":\"AbNg5F.gif\",\"117.gif\":\"AbN6ET.gif\",\"118.gif\":\"AbNcUU.gif\",\"119.gif\":\"AbNRC4.gif\",\"120.gif\":\"AbNhvR.gif\",\"121.gif\":\"AbNf29.gif\",\"122.gif\":\"AbNW8J.gif\",\"123.gif\":\"AbNob6.gif\",\"124.gif\":\"AbN5K1.gif\",\"125.gif\":\"AbNHUO.gif\",\"126.gif\":\"AbNIDx.gif\",\"127.gif\":\"AbN7VK.gif\",\"128.gif\":\"AbNb5D.gif\",\"129.gif\":\"AbNX2d.gif\",\"130.gif\":\"AbNLPe.gif\",\"131.gif\":\"AbNjxA.gif\",\"132.gif\":\"AbNO8H.gif\",\"133.gif\":\"AbNxKI.gif\",\"134.gif\":\"AbNzrt.gif\",\"135.gif\":\"AbU9Vf.gif\",\"136.gif\":\"AbUSqP.gif\",\"137.gif\":\"AbUCa8.gif\",\"138.gif\":\"AbUkGQ.gif\",\"139.gif\":\"AbUFPg.gif\",\"140.gif\":\"AbUPIS.gif\",\"141.gif\":\"AbUZMn.gif\",\"142.gif\":\"AbUExs.gif\",\"143.gif\":\"AbUA2j.gif\",\"144.gif\":\"AbUMIU.gif\",\"145.gif\":\"AbUerq.gif\",\"146.gif\":\"AbUKaT.gif\",\"147.gif\":\"AbUmq0.gif\",\"148.gif\":\"AbUuZV.gif\",\"149.gif\":\"AbUliF.gif\",\"150.gif\":\"AbU1G4.gif\",\"151.gif\":\"AbU8z9.gif\",\"152.gif\":\"AbU3RJ.gif\",\"153.gif\":\"AbUYs1.gif\",\"154.gif\":\"AbUJMR.gif\",\"155.gif\":\"AbUadK.gif\",\"156.gif\":\"AbUtqx.gif\",\"157.gif\":\"AbUUZ6.gif\",\"158.gif\":\"AbUBJe.gif\",\"159.gif\":\"AbUdIO.gif\",\"160.gif\":\"AbU0iD.gif\",\"161.gif\":\"AbUrzd.gif\",\"162.gif\":\"AbUDRH.gif\",\"163.gif\":\"AbUyQA.gif\",\"164.gif\":\"AbUWo8.gif\",\"165.gif\":\"AbU6sI.gif\",\"166.gif\":\"AbU2eP.gif\",\"167.gif\":\"AbUcLt.gif\",\"168.gif\":\"AbU4Jg.gif\",\"169.gif\":\"AbURdf.gif\",\"170.gif\":\"AbUhFS.gif\",\"171.gif\":\"AbU5WQ.gif\",\"172.gif\":\"AbULwV.gif\",\"173.gif\":\"AbUIzj.gif\",\"174.gif\":\"AbUTQs.gif\",\"175.gif\":\"AbU7yn.gif\",\"176.gif\":\"AbUqe0.gif\",\"177.gif\":\"AbUHLq.gif\",\"178.gif\":\"AbUOoT.gif\",\"179.gif\":\"AbUvYF.gif\",\"180.gif\":\"AbUjFU.gif\",\"181.gif\":\"AbaSSJ.gif\",\"182.gif\":\"AbUxW4.gif\",\"183.gif\":\"AbaCO1.gif\",\"184.gif\":\"Abapl9.gif\",\"185.gif\":\"Aba9yR.gif\",\"186.gif\":\"AbaFw6.gif\",\"187.gif\":\"Abaiex.gif\",\"188.gif\":\"AbakTK.gif\",\"189.gif\":\"AbaZfe.png\",\"190.gif\":\"AbaEFO.gif\",\"191.gif\":\"AbaVYD.gif\",\"192.gif\":\"AbamSH.gif\",\"193.gif\":\"AbaKOI.gif\",\"194.gif\":\"Abanld.gif\",\"195.gif\":\"Abau6A.gif\",\"196.gif\":\"AbaQmt.gif\",\"197.gif\":\"Abal0P.gif\",\"198.gif\":\"AbatpQ.gif\",\"199.gif\":\"Aba1Tf.gif\",\"200.png\":\"Aba8k8.png\",\"201.png\":\"AbaGtS.png\",\"202.png\":\"AbaJfg.png\",\"203.png\":\"AbaNlj.png\",\"204.png\":\"Abawmq.png\",\"205.png\":\"AbaU6s.png\",\"206.png\":\"AbaaXn.png\",\"207.png\":\"Aba000.png\",\"208.png\":\"AbarkT.png\",\"209.png\":\"AbastU.png\",\"210.png\":\"AbaB7V.png\",\"211.png\":\"Abafn1.png\",\"212.png\":\"Abacp4.png\",\"213.png\":\"AbayhF.png\",\"214.png\":\"Abag1J.png\",\"215.png\":\"Aba2c9.png\",\"216.png\":\"AbaRXR.png\",\"217.png\":\"Aba476.png\",\"218.png\":\"Abah0x.png\",\"219.png\":\"Abdg58.png\"},\n\t\t\t\t//红包相关参数\n\t\t\t\twindowsState:'',\n\t\t\t\tredenvelopeData:{\n\t\t\t\t\trid:null,\t//红包ID\n\t\t\t\t\tfrom:null,\n\t\t\t\t\tface:null,\n\t\t\t\t\tblessing:null,\n\t\t\t\t\tmoney:null\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tcomputed:{\n\t\t\t...mapState({\n\t\t\t\tcurrentMessageList:state=>state.currentMessageList,\n\t\t\t})\n\t\t},\n\t\twatch:{\n\t\t\tcurrentMessageList(newVal,oldVal){\n\t\t\t\tthis.msgList = newVal\n\t\t\t\tthis.screenMsg(newVal,oldVal)\n\t\t\t},\n\t\t},\n\t\tonLoad(option) {\n\t\t\n\t\t\tthis.userInfo = JSON.parse(uni.getStorageSync('userInfo'))\n\t\t\tthis.toUserId = this.$store.state.toUserId\n\t\t\tthis.conversationActive = this.$store.state.conversationActive\n\t\t\tthis.TIM = this.$TIM\n\t\t\t//获取聊天对象的用户信息---有后端的情况这里 使用后端api请求、\n\t\t\t//防止初次聊天的时候 没有对方的基础信息\n\t\t\tuserList.forEach(item=>{\n\t\t\t\tif(this.toUserId == item.userId){\n\t\t\t\t\tthis.toUserInfo = item\n\t\t\t\t}\n\t\t\t})\n\t\t\tthis.getMsgList();\n\t\t\t//语音自然播放结束\n\t\t\tthis.AUDIO.onEnded((res)=>{\n\t\t\t\tthis.playMsgid=null;\n\t\t\t});\n\t\t\t// #ifndef H5\n\t\t\t//录音开始事件\n\t\t\tthis.RECORDER.onStart((e)=>{\n\t\t\t\tthis.recordBegin(e);\n\t\t\t})\n\t\t\t//录音结束事件\n\t\t\tthis.RECORDER.onStop((e)=>{\n\t\t\t\tthis.recordEnd(e);\n\t\t\t})\n\t\t\t// #endif\n\t\t},\n\t\tonShow(){\n\t\t\tthis.scrollTop = 9999999;\n\t\t\tthis.isHistoryLoading = false;\n\t\t},\n\t\tonUnload(){\n\t\t\t//退出页面 将所有的会话内的消息设置为已读\n\t\t\tlet promise = this.tim.setMessageRead({conversationID: this.conversationActive.conversationID});\n\t\t\tpromise.then(function(imResponse) {\n\t\t\t\tconsole.log('全部已读')\n\t\t\t  // 已读上报成功\n\t\t\t}).catch(function(imError) {\n\t\t\t  // 已读上报失败\n\t\t\t  console.warn('setMessageRead error:', imError);\n\t\t\t});\n\t\t},\n\t\tmethods:{\n\t\t\t//聊天的节点加上外层的div\n\t\t\tnodesFliter(str){\n\t\t\t\tlet nodeStr = '<div style=\"align-items: center;word-wrap:break-word;\">'+str+'</div>' \n\t\t\t\treturn nodeStr\n\t\t\t},\n\t\t\t//时间过滤\n\t\t\ttimeFliter(timer){\n\t\t\t\tlet timeData = new Date(timer*1000)\n\t\t\t\tlet str = this.$commen.dateTimeFliter(timeData)\t\t \n\t\t\t\treturn str\n\t\t\t},\n\t\t\t// 接受消息(定位消息)\n\t\t\tscreenMsg(newVal,oldVal){\n\t\t\t\tif(newVal[0] && oldVal[0]){\n\t\t\t\t\tif(newVal[0].ID != oldVal[0].ID && newVal.length>=this.count ){\t\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet _index = newVal.length-oldVal.length-1\n\t\t\t\t\t\tthis.$nextTick(()=> {this.scrollToView =newVal[_index].ID});\n\t\t\t\t\t\t// console.log(this.scrollToView)\n\t\t\t\t\t\t//拉取历史记录不用改变定位消息\n\t\t\t\t\t}else{\n\t\t\t\t\t\t//新的消息来了 自动向下滑动到最新消息\n\t\t\t\t\t\tthis.$nextTick(()=> {this.scrollToView =newVal[newVal.length-1].ID});\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log('*****')\n\t\t\t\t\t//第一次拉取历史记录 定位到最后一条消息\n\t\t\t\t\tthis.$nextTick(()=> {this.scrollToView =newVal[newVal.length-1].ID;this.scrollTop = 9999999;});\n\t\t\t\t}\n\t\t\t},\n\t\t\t//触发滑动到顶部(加载历史信息记录)\n\t\t\tloadHistory(e){\n\t\t\t\t\tthis.isHistoryLoading = true;\n\t\t\t\t\t// 更多消息列表\n\t\t\t\t\t\tlet conversationID = this.conversationActive.conversationID\n\t\t\t\t\t\tlet promise = this.tim.getMessageList({conversationID: conversationID,nextReqMessageID:this.nextReqMessageID,count: this.count});\n\t\t\t\t\t\tpromise.then((res)=> {\n\t\t\t\t\t\t  this.$store.commit('unshiftCurrentMessageList',  res.data.messageList)\n\t\t\t\t\t\t  this.nextReqMessageID =  res.data.nextReqMessageID // 用于续拉，分页续拉时需传入该字段。\n\t\t\t\t\t\t  this.isCompleted =  res.data.isCompleted\n\t\t\t\t\t\t  this.isHistoryLoading = false;\n\t\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t// //这段代码很重要，不然每次加载历史数据都会跳到顶部\n\t\t\t\t\t// this.$nextTick(function() {\n\t\t\t\t\t// \tthis.scrollToView = this.nextReqMessageID;//跳转上次的第一行信息位置\n\t\t\t\t\t// \tthis.$nextTick(function() {\n\t\t\t\t\t// \t\tthis.scrollAnimation = true;//恢复滚动动画\n\t\t\t\t\t// \t});\t\n\t\t\t\t\t// });\n\t\t\t\t\t\n\t\t\t},\n\t\t\t// 加载初始页面消息\n\t\t\tgetMsgList(){\n\t\t\t\t// 历史消息列表\n\t\t\t\t\tlet conversationID = this.conversationActive.conversationID\n\t\t\t\t\tlet promise = this.tim.getMessageList({conversationID: conversationID, count: this.count});\n\t\t\t\t\tpromise.then((res)=> {\r\n\t\t\t\t\t\tconsole.log(res.data)\r\n\t\t\t\t\t\tif(!res.data.nextReqMessageID){\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.$store.commit('pushCurrentMessageList',  res.data.messageList)\n\t\t\t\t\t  this.nextReqMessageID =  res.data.nextReqMessageID // 用于续拉，分页续拉时需传入该字段。\n\t\t\t\t\t  this.isCompleted =  res.data.isCompleted\n\t\t\t\t\t  this.scrollToView = res.data.messageList[res.data.messageList.length-1].ID\n\t\t\t\t\t});\n\t\t\t\t// 滚动到底部\n\t\t\t\tthis.$nextTick(function() {\n\t\t\t\t\t//进入页面滚动到底部\n\t\t\t\t\tthis.scrollTop = 9999;\n\t\t\t\t\tthis.$nextTick(function() {\n\t\t\t\t\t\tthis.scrollAnimation = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\t//处理图片尺寸，如果不处理宽高，新进入页面加载图片时候会闪\n\t\t\tsetPicSize(content){\n\t\t\t\t// 让图片最长边等于设置的最大长度，短边等比例缩小，图片控件真实改变，区别于aspectFit方式。\n\t\t\t\tlet maxW = uni.upx2px(350);//350是定义消息图片最大宽度\n\t\t\t\tlet maxH = uni.upx2px(350);//350是定义消息图片最大高度\n\t\t\t\tif(content.w>maxW||content.h>maxH){\n\t\t\t\t\tlet scale = content.w/content.h;\n\t\t\t\t\tcontent.w = scale>1?maxW:maxH*scale;\n\t\t\t\t\tcontent.h = scale>1?maxW/scale:maxH;\n\t\t\t\t}\n\t\t\t\treturn content;\n\t\t\t},\n\t\t\t//更多功能(点击+弹出) \n\t\t\tshowMore(){\n\t\t\t\tthis.isVoice = false;\n\t\t\t\tthis.hideEmoji = true;\n\t\t\t\tif(this.hideMore){\n\t\t\t\t\tthis.hideMore = false;\n\t\t\t\t\tthis.openDrawer();\n\t\t\t\t}else{\n\t\t\t\t\tthis.hideDrawer();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 打开抽屉\n\t\t\topenDrawer(){\n\t\t\t\tthis.popupLayerClass = 'showLayer';\n\t\t\t},\n\t\t\t// 隐藏抽屉\n\t\t\thideDrawer(){\n\t\t\t\tthis.popupLayerClass = '';\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tthis.hideMore = true;\n\t\t\t\t\tthis.hideEmoji = true;\n\t\t\t\t},150);\n\t\t\t},\n\t\t\t// 选择图片发送\n\t\t\tchooseImage(){\n\t\t\t\tthis.getImage('album');\n\t\t\t},\n\t\t\t//拍照发送\n\t\t\tcamera(){\n\t\t\t\tthis.getImage('camera');\n\t\t\t},\n\t\t\t//发红包\n\t\t\thandRedEnvelopes(){\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl:'HM-hand/HM-hand'\n\t\t\t\t});\n\t\t\t\tthis.hideDrawer();\n\t\t\t},\n\t\t\t//选照片 or 拍照\n\t\t\tgetImage(type){\n\t\t\t\tthis.hideDrawer();\n\t\t\t\tuni.chooseImage({\n\t\t\t\t\tsourceType:[type],\n\t\t\t\t\tsizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\n\t\t\t\t\tsuccess: (res)=>{\n\t\t\t\t\t\tfor(let i=0;i<res.tempFilePaths.length;i++){\n\t\t\t\t\t\t\tuni.getImageInfo({\n\t\t\t\t\t\t\t\tsrc: res.tempFilePaths[i],\n\t\t\t\t\t\t\t\tsuccess: (image)=>{\n\t\t\t\t\t\t\t\t\tconsole.log(image.width);\n\t\t\t\t\t\t\t\t\tconsole.log(image.height);\n\t\t\t\t\t\t\t\t\tlet msg = {url:res.tempFilePaths[i],w:image.width,h:image.height};\n\t\t\t\t\t\t\t\t\tthis.sendMsg(msg,'img');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t// 选择表情\n\t\t\tchooseEmoji(){\n\t\t\t\tthis.hideMore = true;\n\t\t\t\tif(this.hideEmoji){\n\t\t\t\t\tthis.hideEmoji = false;\n\t\t\t\t\tthis.openDrawer();\n\t\t\t\t}else{\n\t\t\t\t\tthis.hideDrawer();\n\t\t\t\t}\n\t\t\t},\n\t\t\t//添加表情\n\t\t\taddEmoji(em){\n\t\t\t\tthis.textMsg+=em.alt;\n\t\t\t},\n\t\t\t\n\t\t\t//获取焦点，如果不是选表情ing,则关闭抽屉\n\t\t\ttextareaFocus(){\n\t\t\t\tif(this.popupLayerClass=='showLayer' && this.hideMore == false){\n\t\t\t\t\tthis.hideDrawer();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 发送文字消息\n\t\t\tsendText(){\n\t\t\t\tthis.hideDrawer();//隐藏抽屉\n\t\t\t\tif(!this.textMsg){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet content = this.replaceEmoji(this.textMsg);\n\t\t\t\tlet msg = {text:content}\n\t\t\t\tthis.sendMsg(msg,'text');\n\t\t\t\tthis.textMsg = '';//清空输入框\n\t\t\t},\n\t\t\t//替换表情符号为图片\n\t\t\treplaceEmoji(str){\n\t\t\t\tlet replacedStr = str.replace(/\\[([^(\\]|\\[)]*)\\]/g,(item, index)=>{\n\t\t\t\t\tconsole.log(\"item: \" + item);\n\t\t\t\t\tfor(let i=0;i<this.emojiList.length;i++){\n\t\t\t\t\t\tlet row = this.emojiList[i];\n\t\t\t\t\t\tfor(let j=0;j<row.length;j++){\n\t\t\t\t\t\t\tlet EM = row[j];\n\t\t\t\t\t\t\tif(EM.alt==item){\n\t\t\t\t\t\t\t\t//在线表情路径，图文混排必须使用网络路径，请上传一份表情到你的服务器后再替换此路径 \n\t\t\t\t\t\t\t\t//比如你上传服务器后，你的100.gif路径为https://www.xxx.com/emoji/100.gif 则替换onlinePath填写为https://www.xxx.com/emoji/\n\t\t\t\t\t\t\t\tlet onlinePath = 'https://s2.ax1x.com/2019/04/12/'\n\t\t\t\t\t\t\t\tlet imgstr = '<img src=\"'+onlinePath+this.onlineEmoji[EM.url]+'\">';\n\t\t\t\t\t\t\t\tconsole.log(\"imgstr: \" + imgstr);\n\t\t\t\t\t\t\t\treturn imgstr;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn replacedStr;\n\t\t\t},\n\t\t\t\n\t\t\t// 发送消息\n\t\t\tsendMsg(content,type){\n\t\t\t\tlet message = this.tim.createTextMessage({\n\t\t\t\t  to: this.toUserId,\n\t\t\t\t  conversationType: 'C2C',\n\t\t\t\t  payload: {\n\t\t\t\t    text: content.text\n\t\t\t\t  }\n\t\t\t\t});\t\n\t\t\t\tthis.$store.commit('pushCurrentMessageList', message)\n\t\t\t\tlet pomise = this.tim.sendMessage(message)\n\t\t\t\tpomise.then(res=>{\n\t\t\t\t\tthis.$nextTick(()=> {\n\t\t\t\t\t\t// 滚动到底\n\t\t\t\t\t\tthis.scrollToView = res.data.message.ID\n\t\t\t\t\t});\n\t\t\t\t})\t\n\t\t\t},\n\t\t\t\n\t\t\t// 添加文字消息到列表\n\t\t\taddTextMsg(msg){\n\t\t\t\tthis.msgList.push(msg);\n\t\t\t},\n\t\t\t// 添加语音消息到列表\n\t\t\taddVoiceMsg(msg){\n\t\t\t\tthis.msgList.push(msg);\n\t\t\t},\n\t\t\t// 添加图片消息到列表\n\t\t\taddImgMsg(msg){\n\t\t\t\tmsg.msg.content = this.setPicSize(msg.msg.content);\n\t\t\t\tthis.msgImgList.push(msg.msg.content.url);\n\t\t\t\tthis.msgList.push(msg);\n\t\t\t},\n\t\t\taddRedEnvelopeMsg(msg){\n\t\t\t\tthis.msgList.push(msg);\n\t\t\t},\n\t\t\t// 添加系统文字消息到列表\n\t\t\taddSystemTextMsg(msg){\n\t\t\t\tthis.msgList.push(msg);\n\t\t\t},\n\t\t\t// 添加系统红包消息到列表\n\t\t\taddSystemRedEnvelopeMsg(msg){\n\t\t\t\tthis.msgList.push(msg);\n\t\t\t},\n\t\t\t// 打开红包\n\t\t\topenRedEnvelope(msg,index){\n\t\t\t\tlet rid = msg.content.rid;\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle:'加载中...'\n\t\t\t\t});\n\t\t\t\tconsole.log(\"index: \" + index);\n\t\t\t\t//模拟请求服务器效果\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t//加载数据\n\t\t\t\t\tif(rid==0){\n\t\t\t\t\t\tthis.redenvelopeData={\n\t\t\t\t\t\t\trid:0,\t//红包ID\n\t\t\t\t\t\t\tfrom:\"大黑哥\",\n\t\t\t\t\t\t\tface:\"/static/img/im/face/face.jpg\",\n\t\t\t\t\t\t\tblessing:\"恭喜发财，大吉大利\",\n\t\t\t\t\t\t\tmoney:\"已领完\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthis.redenvelopeData={\n\t\t\t\t\t\t\trid:1,\t//红包ID\n\t\t\t\t\t\t\tfrom:\"售后客服008\",\n\t\t\t\t\t\t\tface:\"/static/img/im/face/face_2.jpg\",\n\t\t\t\t\t\t\tblessing:\"恭喜发财\",\n\t\t\t\t\t\t\tmoney:\"0.01\"\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(!msg.content.isReceived){\n\t\t\t\t\t\t\t// {type:\"system\",msg:{id:8,type:\"redEnvelope\",content:{text:\"你领取了售后客服008的红包\"}}},\n\t\t\t\t\t\t\tthis.sendSystemMsg({text:\"你领取了\"+(msg.userinfo.uid==this.myuid?\"自己\":msg.userinfo.username)+\"的红包\"},'redEnvelope');\n\t\t\t\t\t\t\tconsole.log(\"this.msgList[index]: \" + JSON.stringify(this.msgList[index]));\n\t\t\t\t\t\t\tthis.msgList[index].msg.content.isReceived = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\tthis.windowsState = 'show';\n\t\t\t\t\t\n\t\t\t\t},200)\t\n\t\t\t},\n\t\t\t\n\t\t\t// 关闭红包弹窗\n\t\t\tcloseRedEnvelope(){\n\t\t\t\tthis.windowsState = 'hide';\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tthis.windowsState = '';\n\t\t\t\t},200)\n\t\t\t},\n\t\t\tsendSystemMsg(content,type){\n\t\t\t\tlet lastid = this.msgList[this.msgList.length-1].msg.id;\n\t\t\t\tlastid++;\n\t\t\t\tlet row = {type:\"system\",msg:{id:lastid,type:type,content:content}};\n\t\t\t\tthis.screenMsg(row)\n\t\t\t},\n\t\t\t//领取详情\n\t\t\ttoDetails(rid){\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl:'HM-details/HM-details?rid='+rid\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 预览图片\n\t\t\tshowPic(msg){\n\t\t\t\tuni.previewImage({\n\t\t\t\t\tindicator:\"none\",\n\t\t\t\t\tcurrent:msg.content.url,\n\t\t\t\t\turls: this.msgImgList\n\t\t\t\t});\n\t\t\t},\n\t\t\t// 播放语音\n\t\t\tplayVoice(msg){\n\t\t\t\tthis.playMsgid=msg.id;\n\t\t\t\tthis.AUDIO.src = msg.content.url;\n\t\t\t\tthis.$nextTick(function() {\n\t\t\t\t\tthis.AUDIO.play();\n\t\t\t\t});\n\t\t\t},\n\t\t\t// 录音开始\n\t\t\tvoiceBegin(e){\n\t\t\t\tif(e.touches.length>1){\n\t\t\t\t\treturn ;\n\t\t\t\t}\n\t\t\t\tthis.initPoint.Y = e.touches[0].clientY;\n\t\t\t\tthis.initPoint.identifier = e.touches[0].identifier;\n\t\t\t\tthis.RECORDER.start({format:\"mp3\"});//录音开始,\n\t\t\t},\n\t\t\t//录音开始UI效果\n\t\t\trecordBegin(e){\n\t\t\t\tthis.recording = true;\n\t\t\t\tthis.voiceTis='松开 结束';\n\t\t\t\tthis.recordLength = 0;\n\t\t\t\tthis.recordTimer = setInterval(()=>{\n\t\t\t\t\tthis.recordLength++;\n\t\t\t\t},1000)\n\t\t\t},\n\t\t\t// 录音被打断\n\t\t\tvoiceCancel(){\n\t\t\t\tthis.recording = false;\n\t\t\t\tthis.voiceTis='按住 说话';\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\n\t\t\t\tthis.willStop = true;//不发送录音\n\t\t\t\tthis.RECORDER.stop();//录音结束\n\t\t\t},\n\t\t\t// 录音中(判断是否触发上滑取消发送)\n\t\t\tvoiceIng(e){\n\t\t\t\tif(!this.recording){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet touche = e.touches[0];\n\t\t\t\t//上滑一个导航栏的高度触发上滑取消发送\n\t\t\t\tif(this.initPoint.Y - touche.clientY>=uni.upx2px(100)){\n\t\t\t\t\tthis.willStop = true;\n\t\t\t\t\tthis.recordTis = '松开手指 取消发送'\n\t\t\t\t}else{\n\t\t\t\t\tthis.willStop = false;\n\t\t\t\t\tthis.recordTis = '手指上滑 取消发送'\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 结束录音\n\t\t\tvoiceEnd(e){\n\t\t\t\tif(!this.recording){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.recording = false;\n\t\t\t\tthis.voiceTis='按住 说话';\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\n\t\t\t\tthis.RECORDER.stop();//录音结束\n\t\t\t},\n\t\t\t//录音结束(回调文件)\n\t\t\trecordEnd(e){\n\t\t\t\tclearInterval(this.recordTimer);\n\t\t\t\tif(!this.willStop){\n\t\t\t\t\tconsole.log(\"e: \" + JSON.stringify(e));\n\t\t\t\t\tlet msg = {\n\t\t\t\t\t\tlength:0,\n\t\t\t\t\t\turl:e.tempFilePath\n\t\t\t\t\t}\n\t\t\t\t\tlet min = parseInt(this.recordLength/60);\n\t\t\t\t\tlet sec = this.recordLength%60;\n\t\t\t\t\tmin = min<10?'0'+min:min;\n\t\t\t\t\tsec = sec<10?'0'+sec:sec;\n\t\t\t\t\tmsg.length = min+':'+sec;\n\t\t\t\t\tthis.sendMsg(msg,'voice');\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log('取消发送录音');\n\t\t\t\t}\n\t\t\t\tthis.willStop = false;\n\t\t\t},\n\t\t\t// 切换语音/文字输入\n\t\t\tswitchVoice(){\n\t\t\t\tthis.hideDrawer();\n\t\t\t\tthis.isVoice = this.isVoice?false:true;\n\t\t\t},\n\t\t\tdiscard(){\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n</script>\n<style lang=\"scss\">\n\t@import \"@/static/HM-chat/css/style.scss\"; \n</style>\n","import mod from \"-!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../rj/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1593419760956\n      var cssReload = require(\"H:/rj/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}